"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_symbols=require("./utils/symbols"),_exceptions=require("./utils/exceptions"),_iftypeof=_interopRequireDefault(require("./utils/iftypeof"));function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(b,!0).forEach(function(c){(0,_defineProperty2["default"])(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function Action(a,b){var c=this,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.types=Object.freeze({WAIT:"wait",PASS:"pass",THEN:"then"});var e=!1;if(this.disable=function(){e=!0},this.enable=function(){e=!1},this.key=a,this.defaultValue=b,"object"!==(0,_typeof2["default"])(d))throw(0,_exceptions.IsNotObject)("Action");switch(this.options=_objectSpread({typeValue:"any",type:this.types.WAIT,passError:!1,warn:!0},d),this.options.type){case this.types.WAIT:case this.types.PASS:case this.types.THEN:break;default:console.warn("this type action(".concat(this.options.type,") is not recognized. There are only these types[").concat(this.types.WAIT,", ").concat(this.types.PASS,", ").concat(this.types.THEN,"]. Will be assigned by default \"wait\"")),this.options.type=this.types.WAIT;}this[_symbols.symActionLoading]=!1,this[_symbols.symActionListener]=function(){},Object.freeze(this.options),this.dispatch=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){var b,d,f,g,h=arguments;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b=0<h.length&&void 0!==h[0]?h[0]:null,!e){a.next=3;break}return a.abrupt("return",!1);case 3:if(d=null===b?c.defaultValue:b,(0,_iftypeof["default"])(d,c.options.typeValue,c.options.warn,"Action - ".concat(c.key,":"))){a.next=6;break}return a.abrupt("return",!1);case 6:if(c.options.type===c.types.PASS){a.next=10;break}if(!c[_symbols.symActionLoading]){a.next=10;break}return c.options.type===c.types.THEN&&c.memoryThen.push(d),a.abrupt("return",!1);case 10:return f=Object.freeze({key:c.key,defaultValue:c.defaultValue,done:c.done.bind(c)}),c.options.type!==c.types.PASS&&(c[_symbols.symActionLoading]=!0),a.next=14,c[_symbols.symActionListener](d,f);case 14:return g=a.sent,a.abrupt("return",g);case 16:case"end":return a.stop();}},a)})),this.dispatch.disable=this.disable,this.dispatch.enable=this.enable,this.disable=this.disable.bind(this),this.enable=this.enable.bind(this),this.dispatch.bind(this)}Object.defineProperty(Action.prototype,"memoryThen",{value:[],writable:!1,configurable:!1,enumerable:!0}),Action.prototype[_symbols.symActionResendEvent]=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){var b,c,d;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=Object.freeze({key:this.key,defaultValue:this.defaultValue,done:this.done.bind(this)}),c=this.memoryThen[this.memoryThen.length-1],this.memoryThen.length=0,a.next=5,this[_symbols.symActionListener](c,b);case 5:return d=a.sent,this.done(d),a.abrupt("return",d);case 8:case"end":return a.stop();}},a,this)})),Action.prototype.done=function(){return this.options.type===this.types.THEN&&0<this.memoryThen.length?void this[_symbols.symActionResendEvent]():void(this[_symbols.symActionLoading]=!1,this.memoryThen.length=0)},Object.defineProperty(Action.prototype,"onListen",{set:function set(a){if("function"!=typeof a)throw(0,_exceptions.IsNotFunction)("onListen");this[_symbols.symActionListener]=a},configurable:!1,enumerable:!0});var _default=Action;exports["default"]=_default;