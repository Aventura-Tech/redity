"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_symbols=require("./utils/symbols"),_exceptions=require("./utils/exceptions"),_iftypeof=_interopRequireDefault(require("./utils/iftypeof"));function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(b,!0).forEach(function(c){(0,_defineProperty2["default"])(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function Action(a,b){var c=this,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{payload:"any",type:"wait",passError:!1,warn:!0};if(this.types=Object.freeze({WAIT:"wait",PASS:"pass",THEN:"then"}),this[_symbols.symActionKey]=a,this[_symbols.symActionDescription]=b,"object"!==(0,_typeof2["default"])(d))throw(0,_exceptions.IsNotObject)("Action");switch(this.options=_objectSpread({payload:"any",type:this.types.WAIT,passError:!1,warn:!0},d),this.options.type){case this.types.WAIT:case this.types.PASS:case this.types.THEN:break;default:console.warn("this type action(".concat(this.options.type,") is not recognized. There are only these types[").concat(this.types.WAIT,", ").concat(this.types.PASS,", ").concat(this.types.THEN,"]. Will be assigned by default \"wait\"")),this.options.type=this.types.WAIT;}this[_symbols.symActionLoading]=!1,this[_symbols.symActionListener]=function(){},this[_symbols.symActionOnDone]=function(){},Object.freeze(this.options),this.dispatch=function(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if("function"==typeof b&&(c[_symbols.symActionOnDone]=b),!(0,_iftypeof["default"])(a,c.options.payload,c.options.warn))return!1;if(c.options.type!==c.types.PASS&&c[_symbols.symActionLoading])return c.options.type===c.types.THEN&&c.memoryThen.push(a),!1;var d=Object.freeze({key:c[_symbols.symActionKey],description:c[_symbols.symActionDescription],done:c.done.bind(c)});return c.options.type!==c.types.PASS&&(c[_symbols.symActionLoading]=!0),c[_symbols.symActionListener](a,d),!0},this.dispatch.bind(this)}Object.defineProperty(Action.prototype,"memoryThen",{value:[],writable:!1,configurable:!1,enumerable:!0}),Action.prototype[_symbols.symActionResendEvent]=function(){var a=Object.freeze({key:this[_symbols.symActionKey],description:this[_symbols.symActionDescription],done:this.done.bind(this)});this[_symbols.symActionListener](this.memoryThen[this.memoryThen.length-1],a),this.memoryThen.length=0},Action.prototype.done=function(){return this[_symbols.symActionOnDone](!0),this.options.type===this.types.THEN&&0<this.memoryThen.length?void this[_symbols.symActionResendEvent]():void(this[_symbols.symActionLoading]=!1,this.memoryThen.length=0)},Object.defineProperty(Action.prototype,"onListen",{set:function set(a){if("function"!=typeof a)throw(0,_exceptions.IsNotFunction)("onListen");this[_symbols.symActionListener]=a},configurable:!1,enumerable:!0});var _default=Action;exports["default"]=_default;