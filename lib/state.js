"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=State;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_symbols=require("./utils/symbols"),_iftypeof=_interopRequireDefault(require("./utils/iftypeof"));function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(b,!0).forEach(function(c){(0,_defineProperty2["default"])(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function State(a){var b=this;this.key=a.key,this.warn=!!a.warn||a.warn;var c=JSON.stringify(a.val);this[_symbols.symStateVal]=a.val,this[_symbols.symStateHistory]=!!a.history&&a.history,this[_symbols.symStateDeep]=a.deep?a.deep:2,this[_symbols.symStateType]=a.typeValue?a.typeValue:"any",this[_symbols.symStateOnChange]=function(){},this[_symbols.symStateCountChanges]=0,this[_symbols.symStateHistories]=[];var d;(0,_iftypeof["default"])(this[_symbols.symStateVal],this[_symbols.symStateType],this.warn,"State - ".concat(this.key,": ")),Object.defineProperty(this,"val",{get:function get(){return b[_symbols.symStateVal]},enumerable:!0,configurable:!1}),Object.defineProperty(this,"type",{get:function get(){return b[_symbols.symStateType]},enumerable:!0,configurable:!1}),Object.defineProperty(this,"history",{get:function get(){return b[_symbols.symStateHistories]},enumerable:!0,configurable:!1}),Object.defineProperty(this,"changes",{get:function get(){return b[_symbols.symStateCountChanges]},enumerable:!0,configurable:!1}),Object.defineProperty(this,"onChange",{set:function set(a){b[_symbols.symStateOnChange]=a},enumerable:!0,configurable:!1}),this.change=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return void 0===a?b[_symbols.symStateVal]:(0,_iftypeof["default"])(a,b[_symbols.symStateType],b.warn,"State - ".concat(b.key,": "))?JSON.stringify(b[_symbols.symStateVal])===JSON.stringify(a)?b[_symbols.symStateVal]:(d=b[_symbols.symStateVal],b[_symbols.symStateHistory]&&(b[_symbols.symStateHistories].push(b[_symbols.symStateVal]),b[_symbols.symStateHistories].length>b[_symbols.symStateDeep]&&b[_symbols.symStateHistories].splice(0,1)),b[_symbols.symStateOnChange](a),b[_symbols.symStateVal]=a,b[_symbols.symStateCountChanges]+=1,b[_symbols.symStateVal]):b[_symbols.symStateVal]},this.change.init=function(){var a=JSON.parse(c);b.change(a)},this.change.value=function(){var a=b[_symbols.symStateVal];return"object"!==(0,_typeof2["default"])(a)||Array.isArray(a)?Array.isArray(a)?(0,_toConsumableArray2["default"])(a):b[_symbols.symStateVal]:_objectSpread({},a)},this.change.past=function(){var a=b[_symbols.symStateHistories].length;if(0<a){var c=b[_symbols.symStateHistories][a-1];return b[_symbols.symStateOnChange](c),b[_symbols.symStateVal]=c,b[_symbols.symStateCountChanges]+=1,b[_symbols.symStateHistories].pop(),!0}return!1},this.change.unseen=function(a){return void 0===a?b[_symbols.symStateVal]:!!(0,_iftypeof["default"])(a,b[_symbols.symStateType],b.warn,"State - ".concat(b.key,": "))&&JSON.stringify(b[_symbols.symStateVal])!==JSON.stringify(a)&&(b[_symbols.symStateHistory]&&b[_symbols.symStateHistories].push(b[_symbols.symStateVal]),b[_symbols.symStateVal]=a,b[_symbols.symStateCountChanges]+=1,!0)},this.change.initUnseen=function(){var a=JSON.parse(c);b.change.unseen(a)},this.change.initValue=function(){return JSON.parse(c)},this.change.before=function(){return d},this.changeType=function(a){b._type=a}}