"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=_default;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_symbols=require("./utils/symbols"),_exceptions=_interopRequireDefault(require("./utils/exceptions")),_mode=require("./utils/mode"),_states=_interopRequireDefault(require("./states")),_dispatcher=_interopRequireDefault(require("./dispatcher")),_blockcode=_interopRequireDefault(require("./blockcode")),_subscriber=_interopRequireDefault(require("./subscriber")),IsNotObject=_exceptions["default"].IsNotObject;function _default(){var a=this,b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,c={access:_mode.PRIVATE,dev:!0},d=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),e=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),f=function(){},g=new _states["default"],h=new _dispatcher["default"],i=new Map;Object.defineProperty(this,"key",{value:b,enumerable:!0,configurable:!1,writable:!1}),Object.defineProperty(this,"states",{get:function get(){return g.toMethod()},enumerable:!0,configurable:!1}),Object.defineProperty(this,"dispatchers",{get:function get(){return h.toMethod()},enumerable:!0,configurable:!1}),Object.defineProperty(this,"init",{set:function set(a){f=a},enumerable:!0,configurable:!1}),Object.defineProperty(this,"onListen",{set:function set(a){d=a},enumerable:!0,configurable:!1}),Object.defineProperty(this,"onFail",{set:function set(a){e=a},enumerable:!0,configurable:!1});var j={},k={};Object.defineProperties(j,{states:{set:function set(a){g.init(a)},enumerable:!0,configurable:!1},dispatchers:{set:function set(a){h.init(a)},enumerable:!0,configurable:!1}}),Object.defineProperties(k,{states:{set:function set(a){if("object"!==(0,_typeof2["default"])(a)||Array.isArray(a))throw IsNotObject()},enumerable:!0,configurable:!1},dispatchers:{set:function set(a){if("object"!==(0,_typeof2["default"])(a)||Array.isArray(a))throw IsNotObject();for(var b in a){var c=h.get(b);c&&a[b].hasOwnProperty("executeBefore")&&c.dispatch()}},enumerable:!0,configurable:!1},access:{set:function set(a){c.access=a},enumerable:!0,configurable:!1},dev:{set:function set(a){c.dev=a},enumerable:!0,configurable:!1}}),this[_symbols.symModelCreate]=function(){var b=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],l=!!b&&c.dev;g.onListen=function(a,b){var c=!0,d=!1,e=void 0;try{for(var f,g,h=i.entries()[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)g=f.value,g[1][_symbols.symSubscriberGenerate](a,b)}catch(a){d=!0,e=a}finally{try{c||null==h["return"]||h["return"]()}finally{if(d)throw e}}},h.onListen=function(b,c,f){var j={},k=!0,m=!1,n=void 0;try{for(var o,p=i.entries()[Symbol.iterator]();!(k=(o=p.next()).done);k=!0){var q=(0,_slicedToArray2["default"])(o.value,2),r=q[0],s=q[1];j[r]={props:s.props,hide:function hide(){},unhide:function unhide(){},replace:function replace(){}}}}catch(a){m=!0,n=a}finally{try{k||null==p["return"]||p["return"]()}finally{if(m)throw n}}var t={key:a.key,dispatchers:h.toMethod(),payload:b,wait:function wait(){},proceed:function proceed(){},action:c.key,actions:f,models:{},history:{},eventFail:!1,components:Object.freeze(j),blockcode:new _blockcode["default"](l)};return t.resolve=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b){var c;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.blockcode["catch"](b),a.next=3,e(b,g.toMethod(),t);case 3:return c=a.sent,a.abrupt("return",c);case 5:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),Object.freeze(t),t.blockcode.start("Dispatch: ".concat(c.key),b),new Promise(function(a){d(b,g.toMethod(),t).then(function(){var b=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function b(){return _regenerator["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:t.blockcode.end(),a(!0),c.done();case 3:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}())["catch"](function(){var b=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function b(d){return _regenerator["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return t.blockcode["catch"](d),b.next=3,e(d,g.toMethod(),t);case 3:t.blockcode.end(),a(!0),c.done();case 6:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}())})},f(j,k)},this.subscribe=function(a){if(!(a instanceof _subscriber["default"]))throw new Error("Require a instance of Subscriber");return a[_symbols.symSubscriberInit](g.get()),i.set(a.key,a),a.key},this.deleteSubscribe=function(a){i["delete"](a)}}