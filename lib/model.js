"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=_default;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_symbols=require("./utils/symbols"),_exceptions=_interopRequireDefault(require("./utils/exceptions")),_mode=require("./utils/mode"),_states=_interopRequireDefault(require("./states")),_actions=_interopRequireDefault(require("./actions")),_blockcode=_interopRequireDefault(require("./blockcode")),_subscriber=_interopRequireDefault(require("./subscriber"));function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(b,!0).forEach(function(c){(0,_defineProperty2["default"])(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}var IsNotObject=_exceptions["default"].IsNotObject;function _default(){var a=this,b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null,c={access:_mode.PRIVATE,dev:!0},d=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),e=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),f=function(){},g=new _states["default"],h=new _actions["default"],i=new Map;Object.defineProperty(this,"key",{value:b,enumerable:!0,configurable:!1,writable:!1}),Object.defineProperty(this,"states",{get:function get(){return g.toMethod()},enumerable:!0,configurable:!1}),Object.defineProperty(this,"actions",{get:function get(){return h.toMethod()},enumerable:!0,configurable:!1}),Object.defineProperty(this,"init",{set:function set(a){f=a},enumerable:!0,configurable:!1}),Object.defineProperty(this,"onListen",{set:function set(a){d=a},enumerable:!0,configurable:!1}),Object.defineProperty(this,"onFail",{set:function set(a){e=a},enumerable:!0,configurable:!1});var j={};Object.defineProperties(j,{states:{set:function set(a){g.init(a)},enumerable:!0,configurable:!1},actions:{set:function set(a){h.init(a)},enumerable:!0,configurable:!1},configurable:{set:function set(a){if("object"!==(0,_typeof2["default"])(a)||Array.isArray(a))throw IsNotObject("Init - Configurable");c=_objectSpread({},c,{},a)},enumerable:!0,configurable:!1}}),this[_symbols.symModelCreate]=function(){var b=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],k=!!b&&c.dev;f(j),g.onListen=function(a,b){var c=!0,d=!1,e=void 0;try{for(var f,g,h=i.entries()[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)g=f.value,g[1][_symbols.symSubscriberGenerate](a,b)}catch(a){d=!0,e=a}finally{try{c||null==h["return"]||h["return"]()}finally{if(d)throw e}}},h.onListen=function(b,c,f){var j={},l=!0,m=!1,n=void 0;try{for(var o,p=i.entries()[Symbol.iterator]();!(l=(o=p.next()).done);l=!0){var q=(0,_slicedToArray2["default"])(o.value,2),r=q[0],s=q[1];j[r]={props:s.props,hide:function hide(){},unhide:function unhide(){},replace:function replace(){}}}}catch(a){m=!0,n=a}finally{try{l||null==p["return"]||p["return"]()}finally{if(m)throw n}}var t={key:a.key,actions:h.toMethod(),payload:b,wait:function wait(){},proceed:function proceed(){},event:c.key,events:f,models:{},history:{},eventFail:!1,components:Object.freeze(j),blockcode:new _blockcode["default"](k)};return t.resolve=function(){var a=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function a(b){var c;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.blockcode["catch"](b),a.next=3,e(b,t,g.toMethod());case 3:return c=a.sent,a.abrupt("return",c);case 5:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}(),Object.freeze(t),t.blockcode.start("Action: ".concat(c.key),b),new Promise(function(a){d(b,t,g.toMethod()).then(function(){var b=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function b(){return _regenerator["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:t.blockcode.end(),a(!0);case 2:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}())["catch"](function(){var b=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function b(c){return _regenerator["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return t.blockcode["catch"](c),b.next=3,e(c,t,g.toMethod());case 3:t.blockcode.end(),a(!0);case 5:case"end":return b.stop();}},b)}));return function(){return b.apply(this,arguments)}}())})}},this.subscribe=function(a){if(!(a instanceof _subscriber["default"]))throw new Error("Require a instance of Subscriber");return a[_symbols.symSubscriberInit](g.get()),i.set(a.key,a),a.key},this.deleteSubscribe=function(a){i["delete"](a)}}